# Configuration

This document enumerates environment variables by service. Use `../example.env`
for sample values and defaults.

## API and worker (shared)
Required:
- `DATABASE_URL`: async SQLAlchemy URL for the primary database.
- `JWT_SECRET_KEY`: signing secret for access and refresh tokens.
- `TMDB_API_AUTH_HEADER` or `TMDB_API_KEY`: TMDB credentials are required at
  startup (settings validation).

Core settings (optional unless noted):
- `APP_NAME` (default: `Tastebuds API`): API display name.
- `ENVIRONMENT` (default: `development`): controls test shortcuts and logging.
- `API_PREFIX` (default: `/api`): API route prefix.
- `NEXT_PUBLIC_APP_BASE_URL` (default: `https://localhost`): base URL for share
  links and absolute URLs generated by the API.
- `TEST_DATABASE_URL` (optional): database URL for pytest or local testing.
- `LOG_LEVEL` (default: `INFO`): API log level.
- `CORS_ORIGINS` (default: `http://localhost:3000,http://127.0.0.1:3000`):
  allowed origins (CSV or JSON array).

Auth and session:
- `ACCESS_TOKEN_EXPIRES_MINUTES` (default: `30`).
- `REFRESH_TOKEN_EXPIRES_MINUTES` (default: `10080`).
- `JWT_ALGORITHM` (default: `HS256`).

Queues and ops:
- `REDIS_URL` (default: `redis://redis:6379/0`).
- `WORKER_QUEUE_NAMES` (default: `default,ingestion,integrations,maintenance,webhooks,sync`).
- `OPS_ADMIN_EMAILS` (default: empty): allowlist for `/api/ops/*`.
- `HEALTH_ALLOWLIST` (default: empty): host/IP allowlist for health telemetry.
- `CREDENTIAL_VAULT_KEY` (optional): key for encrypting stored credentials.

Ingestion, previews, and retention:
- `EXTERNAL_SEARCH_QUOTA_MAX_REQUESTS` (default: `10`).
- `EXTERNAL_SEARCH_QUOTA_WINDOW_SECONDS` (default: `60`).
- `EXTERNAL_SEARCH_PREVIEW_TTL_SECONDS` (default: `300`).
- `EXTERNAL_SEARCH_PREVIEW_MAX_PAYLOAD_BYTES` (default: `50000`).
- `EXTERNAL_SEARCH_PREVIEW_MAX_METADATA_BYTES` (default: `20000`).
- `INGESTION_PAYLOAD_RETENTION_DAYS` (default: `90`).
- `INGESTION_PAYLOAD_MAX_BYTES` (default: `250000`).
- `INGESTION_METADATA_MAX_BYTES` (default: `50000`).
- `AVAILABILITY_REFRESH_DAYS` (default: `7`).
- `TASTE_PROFILE_REFRESH_HOURS` (default: `24`).
- `DRAFT_SHARE_TOKEN_TTL_DAYS` (default: `7`).

External connector credentials:
- `GOOGLE_BOOKS_API_KEY` (optional).
- `IGDB_CLIENT_ID` and `IGDB_CLIENT_SECRET` (optional, required for IGDB).
- `LASTFM_API_KEY` (optional, required for Last.fm).
- `SPOTIFY_CLIENT_ID` and `SPOTIFY_CLIENT_SECRET` (optional for integrations).
- `SPOTIFY_REDIRECT_URI` (optional, default set in `example.env`).
- `SPOTIFY_SCOPES` (default:
  `playlist-modify-private,playlist-modify-public,user-read-email`).

List parsing: `CORS_ORIGINS`, `OPS_ADMIN_EMAILS`, `WORKER_QUEUE_NAMES`,
`HEALTH_ALLOWLIST`, and `SPOTIFY_SCOPES` accept CSV or JSON arrays.

## Web (Next.js)
- `NEXT_PUBLIC_API_BASE` (default: `https://localhost/api`): browser base URL.
- `API_INTERNAL_BASE` (default: `http://api:8000/api`): server-side base URL.
- `NEXT_PUBLIC_APP_BASE_URL` (default: `http://localhost:3000` in the web app):
  absolute link base for public pages.

## Proxy (nginx)
- `CERT_DIR` (default: `/etc/nginx/certs`).
- `CERT_PATH` (default: `$CERT_DIR/dev.crt`).
- `KEY_PATH` (default: `$CERT_DIR/dev.key`).
- `TLS_CERT_DAYS` (default: `30`).
- `TLS_ROTATE_WITHIN_SECONDS` (default: `1209600`).
- `TLS_ROTATE_CHECK_INTERVAL_SECONDS` (default: `43200`).
- `TLS_CERT_SUBJECT` (default:
  `/C=US/ST=Local/L=Local/O=Tastebuds/OU=Dev/CN=localhost`).

## Security-sensitive settings
- `DATABASE_URL`, `TEST_DATABASE_URL`, `REDIS_URL`.
- `JWT_SECRET_KEY`, `CREDENTIAL_VAULT_KEY`.
- `TMDB_API_AUTH_HEADER`, `TMDB_API_KEY`, `IGDB_CLIENT_SECRET`.
- `GOOGLE_BOOKS_API_KEY`, `LASTFM_API_KEY`.
- `SPOTIFY_CLIENT_SECRET`.
- `OPS_ADMIN_EMAILS`, `HEALTH_ALLOWLIST`.
